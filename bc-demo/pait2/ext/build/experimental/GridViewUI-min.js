/*
 * Ext JS Library 1.0.1
 * Copyright(c) 2006-2007, Ext JS, LLC.
 * licensing@extjs.com
 * 
 * http://www.extjs.com/license
 */

Ext.grid.GridView.Template=function(_1){Ext.apply(this,_1);var rc=this.rootCls;var ts=this.templates||{};if(!ts.master){ts.master=new Ext.Template("<div class=\"",rc,"\" hidefocus=\"true\">","<div class=\"",rc,"-topbar\"></div>","<div class=\"",rc,"-viewport\">","<div class=\"",rc,"-header\"><div class=\"",rc,"-header-pop\"><div class=\"",rc,"-header-pop-inner\">&#160;</div></div><div class=\"",rc,"-header-inner\">{header}</div><div class=\"x-clear\"></div></div>","<div class=\"",rc,"-body\">{body}</div>","</div>","<div class=\"",rc,"-bottombar\"></div>","<a href=\"#\" class=\"",rc,"-focus\" tabIndex=\"-1\"></a>","<div class=\"",rc,"-resize-proxy\">&#160;</div>","</div>");}if(!ts.header){ts.header=new Ext.Template("<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"{tstyle}\">","<tbody><tr class=\"",rc,"-hd-row\">{cells}</tr></tbody>","</table>");}if(!ts.hcell){ts.hcell=new Ext.Template("<td class=\"",rc,"-hd ",rc,"-cell ",rc,"-td-{id}\" style=\"{style}\"><div {attr} class=\"",rc,"-hd-inner ",rc,"-hd-{id}\" unselectable=\"on\">","{value}<img class=\"",rc,"-sort-icon\" src=\"",Ext.BLANK_IMAGE_URL,"\" />","</div></td>");}if(!ts.body){ts.body=new Ext.Template("{rows}");}if(!ts.row){ts.row=new Ext.Template("<div class=\"",rc,"-row {alt}\" style=\"{tstyle}\"><table class=\"",rc,"-row-table\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"{tstyle}\">","<tbody><tr>{cells}</tr>","<tr style=\"{bodyStyle}\"><td colspan=\"{cols}\" class=\"",rc,"-body-cell\"><div class=\"",rc,"-row-body\"></div></td></tr></tbody>","</table></div>");}if(!ts.cell){ts.cell=new Ext.Template("<td class=\"",rc,"-col ",rc,"-cell ",rc,"-td-{id} {css}\" style=\"{style}\" tabIndex=\"0\" {cellAttr}>","<div class=\"",rc,"-cell-inner ",rc,"-col-{id}\" unselectable=\"on\" {attr}>{value}</div>","</td>");}for(var k in ts){var t=ts[k];if(t&&typeof t.compile=="function"&&!t.compiled){t.disableFormats=true;t.compile();}}this.templates=ts;this.tdClass=""+rc+"-cell";this.cellSelector="td."+rc+"-cell";this.hdCls=rc+"-hd";this.rowSelector="div."+rc+"-row";this.colRe=new RegExp(rc+"-td-([^\\s]+)","");};Ext.grid.GridView.Template.prototype={rootCls:"x-grid3",sortClasses:["sort-asc","sort-desc"],fly:function(el){if(!this._flyweight){this._flyweight=new Ext.Element.Flyweight(document.body);}this._flyweight.dom=el;return this._flyweight;},initElements:function(){var E=Ext.Element;var el=this.grid.container.dom.firstChild;var cs=el.childNodes;this.el=new E(el);this.headerPanel=new E(el.firstChild);this.headerPanel.enableDisplayMode("block");this.mainWrap=new E(cs[1]);this.mainHd=new E(this.mainWrap.dom.firstChild);this.innerHd=this.mainHd.dom.childNodes[1];this.headerPop=new E(this.mainHd.dom.firstChild.firstChild);this.mainBody=new E(this.mainWrap.dom.childNodes[1]);this.footerPanel=new E(cs[2]);this.footerPanel.enableDisplayMode("block");this.focusEl=new E(cs[3]);this.focusEl.swallowEvent("click",true);this.resizeProxy=new E(cs[4]);},getHeaderPanel:function(_a){if(_a){this.headerPanel.show();}return this.headerPanel;},getFooterPanel:function(_b){if(_b){this.footerPanel.show();}return this.footerPanel;},findCell:function(el){if(!el){return false;}return this.fly(el).findParent(this.cellSelector,3);},findCellIndex:function(el,_e){var _f=this.findCell(el);if(_f&&(!_e||this.fly(_f).hasClass(_e))){return this.getCellIndex(_f);}return false;},getCellIndex:function(el){if(el){var m=el.className.match(this.colRe);if(m&&m[1]){return this.cm.getIndexById(m[1]);}}return false;},findHeaderCell:function(el){var _13=this.findCell(el);return _13&&this.fly(_13).hasClass(this.hdCls)?_13:null;},findHeaderIndex:function(el){return this.findCellIndex(el,this.hdCls);},findRow:function(el){if(!el){return false;}return this.fly(el).findParent(this.rowSelector,10);},findRowIndex:function(el){var r=this.findRow(el);return r?r.rowIndex:false;},getRow:function(row){return this.mainBody.dom.childNodes[row];},getCell:function(row,col){return this.mainBody.dom.getElementsByTagName("td")[col];},getHeaderCell:function(_1b){return this.mainHd.dom.getElementsByTagName("td")[_1b];},addRowClass:function(row,cls){var r=this.getRow(row);if(r){this.fly(r).addClass(cls);}},removeRowClass:function(row,cls){var r=this.getRow(row);if(r){this.fly(r).removeClass(cls);}},removeRow:function(row){var r=this.getRow(row);if(r){r.parentNode.removeChild(r);}},removeRows:function(_24,_25){var bd=this.mainBody.dom;for(var _27=_24;_27<=_25;_27++){bd.removeChild(bd.childNodes[_24]);}},getScrollState:function(){var sb=this.mainBody.dom;return {left:sb.scrollLeft,top:sb.scrollTop};},restoreScroll:function(_29){var sb=this.mainBody.dom;sb.scrollLeft=_29.left;sb.scrollTop=_29.top;},scrollToTop:function(){this.mainBody.dom.scrollTop=0;this.mainBody.dom.scrollLeft=0;},syncScroll:function(){this.mainBody.dom.scrollLeft=this.innerHd.scrollLeft=this.mainBody.dom.scrollLeft;},updateSortIcon:function(col,dir){var sc=this.sortClasses;var hds=this.mainHd.select("td").removeClass(sc);hds.item(col).addClass(sc[dir=="DESC"?1:0]);},updateAllColumnWidths:function(){var tw=this.getTotalWidth();var _30=this.cm.getColumnCount();var ws=[];for(var i=0;i<_30;i++){ws[i]=this.getColumnWidth(i);}this.mainHd.dom.childNodes[1].firstChild.style.width=tw;for(var i=0;i<_30;i++){var hd=this.getHeaderCell(i);hd.style.width=ws[i];}var ns=this.mainBody.dom.childNodes;for(var i=0,len=ns.length;i<len;i++){ns[i].style.width=tw;ns[i].firstChild.style.width=tw;var row=ns[i].firstChild.rows[0];for(var j=0;j<_30;j++){row.childNodes[j].style.width=ws[j];}}},updateColumnWidth:function(col,_39){var w=this.getColumnWidth(col);var tw=this.getTotalWidth();this.mainHd.dom.childNodes[1].firstChild.style.width=tw;var hd=this.getHeaderCell(col);hd.style.width=w;var ns=this.mainBody.dom.childNodes;for(var i=0,len=ns.length;i<len;i++){ns[i].style.width=tw;ns[i].firstChild.style.width=tw;ns[i].firstChild.rows[0].childNodes[col].style.width=w;}},updateColumnText:function(col,_41){},afterMove:function(_42){},doRender:function(cs,rs,ds,_46,_47,_48){var ts=this.templates,ct=ts.cell,rt=ts.row;var _4c="width:"+this.getTotalWidth()+";";var buf=[],cb,c,p={},rp={tstyle:_4c},r;for(var j=0,len=rs.length;j<len;j++){r=rs[j],cb=[],rowIndex=(j+_46);for(var i=0;i<_47;i++){c=cs[i];p.id=c.id;p.css=p.attr="";p.value=c.renderer(r.data[c.name],p,r,rowIndex,i,ds);p.style=c.style;if(p.value==undefined||p.value===""){p.value="&#160;";}if(r.dirty&&typeof r.modified[c.name]!=="undefined"){p.css+=" x-grid-dirty-cell";}cb[cb.length]=ct.apply(p);}var alt=[];if(_48&&((rowIndex+1)%2==0)){alt[0]="x-grid-row-alt";}if(r.dirty){alt[1]=" x-grid-dirty-row";}if(this.getRowClass){alt[2]=this.getRowClass(r,rowIndex);}rp.alt=alt.join(" ");rp.cells=cb.join("");buf[buf.length]=rt.apply(rp);}return buf.join("");},stripeRows:function(_57,_58){if(this.ds.getCount()<1){return;}_58=_58||!this.grid.stripeRows;_57=_57||0;var _59=this.mainBody.dom.childNodes;var cls=" x-grid-row-alt ";for(var i=_57,len=_59.length;i<len;i++){var row=_59[i];row.rowIndex=i;if(!_58){var _5e=((i+1)%2==0);var _5f=(" "+row.className+" ").indexOf(cls)!=-1;if(_5e==_5f){continue;}if(_5e){row.className+=" x-grid-row-alt";}else{row.className=row.className.replace("x-grid-row-alt","");}}}},renderUI:function(){var _60=this.renderHeaders();var _61=this.templates.body.apply({rows:""});var _62=this.templates.master.apply({body:_61,header:_60});this.grid.container.dom.innerHTML=_62;this.initElements();this.mainHd.on("mouseover",this.handleHdOver,this);this.mainHd.on("mouseout",this.handleHdOut,this);this.mainHd.on("mousemove",this.handleHdMove,this);this.mainHd.on("dblclick",this.handleSplitDblClick,this,{delegate:"."+this.splitClass});this.mainBody.on("scroll",this.syncScroll,this);if(this.grid.enableColumnResize!==false){new Ext.grid.GridView.SplitDragZone(this.grid,this.mainHd.dom);}if(this.grid.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(this.grid,this.mainHd.dom);new Ext.grid.HeaderDropZone(this.grid,this.mainHd.dom);}this.updateHeaderSortState();},layout:function(_63,_64){var g=this.grid;var c=g.container,cm=this.cm,_68=g.autoExpandColumn,gv=this;if(g.autoWidth){c.setWidth(cm.getTotalWidth()+c.getBorderWidth("lr"));}if(g.autoHeight){this.mainBody.dom.style.overflow="visible";return;}var _6a=16;var tbh=this.headerPanel.getHeight();var bbh=this.footerPanel.getHeight();var _6d=c.getSize(true);this.el.setSize(_6d.width,_6d.height);this.headerPanel.setWidth(_6d.width);this.footerPanel.setWidth(_6d.width);var _6e=this.mainHd.getHeight();var vw=_6d.width;var vh=_6d.height-(_6e+tbh+bbh);this.mainBody.setSize(vw,vh);this.innerHd.style.width=(vw-16)+"px";this.headerPop.setHeight(this.innerHd.offsetHeight);this.autoExpand();if(this.forceFit){this.fitColumns(false,false);}return;var bt=this.getBodyTable();var _72=hasLock?Math.max(this.getLockedTable().offsetWidth,this.lockedHd.dom.firstChild.offsetWidth):0;var _73=bt.offsetHeight;var _74=_72+bt.offsetWidth;var _75=false,_76=false;this.scrollSizer.setSize(_74,_73+_6e);var lw=this.lockedWrap,mw=this.mainWrap;var lb=this.lockedBody,mb=this.mainBody;setTimeout(function(){var t=s.dom.offsetTop;var w=s.dom.clientWidth,h=s.dom.clientHeight;lw.setTop(t);lw.setSize(_72,h);mw.setLeftTop(_72,t);mw.setSize(w-_72,h);lb.setHeight(h-_6e);mb.setHeight(h-_6e);if(_63){lw.show();mw.show();}},10);}};Ext.grid.GridView.SplitDragZone=function(_7e,hd){this.grid=_7e;this.view=_7e.getView();this.proxy=this.view.resizeProxy;Ext.grid.GridView.SplitDragZone.superclass.constructor.call(this,hd,"gridSplitters"+this.grid.container.id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:false});this.scroll=false;this.hw=this.view.splitHandleWidth||5;};Ext.extend(Ext.grid.GridView.SplitDragZone,Ext.dd.DDProxy,{b4StartDrag:function(x,y){this.view.headersDisabled=true;this.proxy.setHeight(this.view.mainWrap.getHeight());var w=this.cm.getColumnWidth(this.cellIndex);var _83=Math.max(w-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(_83,1000);this.setYConstraint(0,0);this.minX=x-_83;this.maxX=x+1000;this.startPos=x;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,x,y);},handleMouseDown:function(e){var t=this.view.findHeaderCell(e.getTarget());if(t){var xy=this.view.fly(t).getXY(),x=xy[0],y=xy[1];var exy=e.getXY(),ex=exy[0],ey=exy[1];var w=t.offsetWidth,_8d=false;if((ex-x)<=this.hw){_8d=-1;}else{if((x+w)-ex<=this.hw){_8d=0;}}if(_8d!==false){this.cellIndex=this.view.getCellIndex(t)+_8d;this.split=t.dom;this.cm=this.grid.colModel;if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){Ext.grid.GridView.SplitDragZone.superclass.handleMouseDown.apply(this,arguments);}}else{if(this.view.columnDrag){this.view.columnDrag.callHandleMouseDown(e);}}}},endDrag:function(e){var v=this.view;var _90=Math.max(this.minX,e.getPageX());var _91=_90-this.startPos;v.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+_91);setTimeout(function(){v.headersDisabled=false;},50);},autoOffset:function(){this.setDelta(0,0);}});Ext.grid.GridView.ColumnDragZone=function(_92,hd){Ext.grid.GridView.ColumnDragZone.superclass.constructor.call(this,_92,hd,null);this.proxy.el.addClass("x-grid3-col-dd");};Ext.extend(Ext.grid.GridView.ColumnDragZone,Ext.grid.HeaderDragZone,{handleMouseDown:function(e){},callHandleMouseDown:function(e){Ext.grid.GridView.ColumnDragZone.superclass.handleMouseDown.call(this,e);}});
